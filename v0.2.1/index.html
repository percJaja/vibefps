<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FPS Game - Vibe Jam 2025</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¯¸ë¦¬ ë¡œë“œ -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js" as="script">
  <style>
    /* í•„ìˆ˜ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ - ì¦‰ì‹œ í™”ë©´ì— í‘œì‹œí•  ìš”ì†Œì— ëŒ€í•œ ìŠ¤íƒ€ì¼ */
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'system-ui', sans-serif;
      touch-action: none;
      background-color: #000;
    }
    
    #overlayTip {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 24px;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      z-index: 1000;
      opacity: 0.8;
      pointer-events: none; /* í´ë¦­/í„°ì¹˜ë¥¼ í†µê³¼ì‹œí‚´ */
      transition: opacity 0.5s;
      animation: fadeInOut 3s forwards;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }
    
    /* ì‹œì‘ í™”ë©´ ìˆ¨ê¹€ */
    #startScreen {
      display: none;
    }
    
    #gameUI {
      opacity: 0;
      transition: opacity 1s;
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 18px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    #gameUI.visible {
      opacity: 1;
    }
    
    /* ì„¤ì • ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì • - ìš°ì¸¡ ìƒë‹¨ìœ¼ë¡œ ì´ë™ */
    .settings-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      z-index: 1000; /* ë†’ì€ z-index ê°’ìœ¼ë¡œ ìƒí˜¸ì‘ìš© ë³´ì¥ */
      font-weight: bold;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
      transition: all 0.3s;
      /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      /* í„°ì¹˜ ë™ì‘ ëª…ì‹œì  í—ˆìš© */
      touch-action: manipulation;
    }

    /* ë¹„í™œì„±í™” ìƒíƒœì˜ ì„¤ì • ë²„íŠ¼ (v0.1.4 ì¶”ê°€) */
    .settings-btn.disabled {
      opacity: 0.7;
      cursor: pointer;
      pointer-events: auto;
    }
    
    /* ì„¤ì • ë²„íŠ¼ ìˆ¨ê¹€ ìƒíƒœ */
    .settings-btn.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    
    .settings-btn:hover {
      background-color: rgba(50, 50, 50, 0.7);
    }
    
    /* í–¥ìƒëœ ì„¤ì • ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    .settings-grid {
      display: grid;
      grid-template-columns: 150px 150px;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .settings-section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .settings-header {
      font-size: 18px;
      margin-bottom: 15px;
      color: #4CAF50;
    }
    
    select, input {
      background-color: rgba(40, 40, 40, 0.8);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.5);
      padding: 6px 8px;
      border-radius: 4px;
      width: 100%;
    }
    
    /* ì„¤ì • í™”ë©´ ìŠ¤íƒ€ì¼ ê°œì„  */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      z-index: 100;
    }
    
    #settingsScreen {
      padding: 0;
      justify-content: flex-start;
      overflow: hidden;
      z-index: 101;
    }
    
    /* ì„¤ì • í™”ë©´ ì œëª© ì˜ì—­ */
    .settings-title {
      width: 100%;
      text-align: center;
      padding: 15px 0;
      position: relative;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 2;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* ì„¤ì • í™”ë©´ ë‚´ìš© ì˜ì—­ - ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
    .settings-content {
      width: 100%;
      flex: 1;
      overflow-y: scroll;
      -webkit-overflow-scrolling: touch; /* iOS ìŠ¤í¬ë¡¤ ê°œì„  */
      padding: 0 20px;
      box-sizing: border-box;
      overscroll-behavior: contain; /* ë°”ìš´ìŠ¤ íš¨ê³¼ ì œí•œ */
      position: relative;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    .settings-content::-webkit-scrollbar {
      width: 8px;
    }
    
    .settings-content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }
    
    .settings-content::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }
    
    /* ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ - ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ í•­ìƒ ë³´ì´ë„ë¡ */
    .return-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 15px 25px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
      touch-action: manipulation;
      width: 80%;
      max-width: 300px;
      margin: 15px auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1001;
    }
    
    .return-button:hover {
      background-color: #3e8e41;
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ í‘œì‹œë  ìš”ì†Œì™€ ìˆ¨ê²¨ì§ˆ ìš”ì†Œ */
    body.is-mobile .pc-only {
      display: none !important;
    }
    
    body.is-mobile .mobile-only {
      display: block !important;
    }
    
    /* ê°€ë¡œ ëª¨ë“œì—ì„œ ì„¤ì • í™”ë©´ ìµœì í™” */
    @media (orientation: landscape) {
      .settings-content {
        padding-bottom: 80px; /* í•˜ë‹¨ ë²„íŠ¼ ê³µê°„ í™•ë³´ */
      }
      
      /* ê°€ë¡œ ëª¨ë“œì—ì„œ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ìµœì í™” */
      .settings-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      /* ê°€ë¡œ ëª¨ë“œì—ì„œ ë©”ì¸ UI í¬ê¸° ì¶•ì†Œ */
      #gameUI {
        font-size: 14px;
      }
    }
    
    /* ëª¨ë°”ì¼ì—ì„œì˜ ì„¤ì • ê·¸ë¦¬ë“œ ì¡°ì • */
    @media (max-width: 768px) {
      .settings-grid {
        grid-template-columns: 120px 150px;
      }
    }
  </style>
</head>
<body>
  <!-- í•„ìˆ˜ ì¡°ì‘ë²• íŒ (ì‚¬ë¼ì§) -->
  <div id="overlayTip">
    <p data-i18n="tipControls">WASDë¡œ ì´ë™, ë§ˆìš°ìŠ¤ë¡œ ì¡°ì¤€, í´ë¦­ìœ¼ë¡œ ë°œì‚¬</p>
    <p data-i18n="tipTargets">ë¹¨ê°„ìƒ‰: ì¼ë°˜ (10ì ) | ê¸ˆìƒ‰: ë³´ë„ˆìŠ¤ (25ì ) | ë…¹ìƒ‰: í˜ë„í‹° (-15ì )</p>
  </div>

  <!-- ê²Œì„ ì‹œì‘ í™”ë©´ (ìˆ¨ê¹€) -->
  <div id="startScreen" class="screen">
      <h1 data-i18n="gameTitle">FPS ê²Œì„</h1>
      <p data-i18n="tipControls">WASDë¡œ ì´ë™, ë§ˆìš°ìŠ¤ë¡œ ì¡°ì¤€, í´ë¦­ìœ¼ë¡œ ë°œì‚¬</p>
      <p data-i18n="tipTargets">ë¹¨ê°„ìƒ‰ íƒ€ê²Ÿ: ì¼ë°˜ (10ì ) | ê¸ˆìƒ‰ íƒ€ê²Ÿ: ë³´ë„ˆìŠ¤ (25ì ) | ë…¹ìƒ‰ íƒ€ê²Ÿ: í˜ë„í‹° (-15ì )</p>
      <p data-i18n="comboBenefit">ì—°ì† íƒ€ê²©ìœ¼ë¡œ ì½¤ë³´ ì ìˆ˜ë¥¼ ì–»ìœ¼ì„¸ìš”!</p>
      <button id="startButton" class="button" data-i18n="startButton">ê²Œì„ ì‹œì‘</button>
  </div>
  
  <!-- ê°œì„ ëœ í†µí•© ì„¤ì • í™”ë©´ -->
  <div id="settingsScreen" class="screen">
      <!-- ì„¤ì • íƒ€ì´í‹€ (ê³ ì •) -->
      <div class="settings-title">
          <h2 data-i18n="settingsTitle">ì„¤ì •</h2>
      </div>
      
      <!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì„¤ì • ë‚´ìš© -->
      <div class="settings-content">
          <!-- ì–¸ì–´ ì„¤ì • ì„¹ì…˜ -->
          <div class="settings-section">
              <div class="settings-header" data-i18n="languageSettings">ì–¸ì–´ ì„¤ì •</div>
              <div class="settings-grid">
                  <div data-i18n="language">ì–¸ì–´:</div>
                  <div>
                      <select id="languageSelect">
                          <option value="ko">í•œêµ­ì–´</option>
                          <option value="en">English</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- í‚¤ ì„¤ì • ì„¹ì…˜ (PC ì „ìš©) -->
          <div class="settings-section pc-only" id="keyboardSettings">
              <div class="settings-header" data-i18n="controlSettings">ì¡°ì‘ ì„¤ì •</div>
              <div class="settings-grid">
                  <div data-i18n="forwardMove">ì•ìœ¼ë¡œ ì´ë™:</div>
                  <div>
                      <select id="forwardKey" class="keyBinding">
                          <option value="KeyW">W</option>
                          <option value="KeyS">S</option>
                          <option value="ArrowUp">â†‘</option>
                      </select>
                  </div>
                  
                  <div data-i18n="backwardMove">ë’¤ë¡œ ì´ë™:</div>
                  <div>
                      <select id="backwardKey" class="keyBinding">
                          <option value="KeyS">S</option>
                          <option value="KeyW">W</option>
                          <option value="ArrowDown">â†“</option>
                      </select>
                  </div>
                  
                  <div data-i18n="leftMove">ì™¼ìª½ ì´ë™:</div>
                  <div>
                      <select id="leftKey" class="keyBinding">
                          <option value="KeyA">A</option>
                          <option value="KeyD">D</option>
                          <option value="ArrowLeft">â†</option>
                      </select>
                  </div>
                  
                  <div data-i18n="rightMove">ì˜¤ë¥¸ìª½ ì´ë™:</div>
                  <div>
                      <select id="rightKey" class="keyBinding">
                          <option value="KeyD">D</option>
                          <option value="KeyA">A</option>
                          <option value="ArrowRight">â†’</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- ëª¨ë°”ì¼ ì„¤ì • ì„¹ì…˜ (ëª¨ë°”ì¼ ì „ìš©) -->
          <div class="settings-section mobile-only" id="mobileSettings" style="display: none;">
              <div class="settings-header" data-i18n="mobileSettings">ëª¨ë°”ì¼ ì„¤ì •</div>
              <div class="settings-grid">
                  <div data-i18n="touchSensitivity">í„°ì¹˜ ê°ë„:</div>
                  <div>
                      <input type="range" id="touchSensitivity" min="0.5" max="2" step="0.1" value="1">
                  </div>
              </div>
          </div>
          
          <!-- ì†Œë¦¬ ì„¤ì • ì„¹ì…˜ -->
          <div class="settings-section">
              <div class="settings-header" data-i18n="audioSettings">ì†Œë¦¬ ì„¤ì •</div>
              <div class="settings-grid">
                  <div data-i18n="musicVolume">ìŒì•… ë³¼ë¥¨:</div>
                  <div>
                      <input type="range" id="musicVolume" min="0" max="1" step="0.1" value="0.5">
                  </div>
                  
                  <div data-i18n="sfxVolume">íš¨ê³¼ìŒ ë³¼ë¥¨:</div>
                  <div>
                      <input type="range" id="sfxVolume" min="0" max="1" step="0.1" value="0.7">
                  </div>
              </div>
          </div>
          
          <!-- ê³ ê¸‰ ì˜¤ë””ì˜¤ ì„¤ì • ì„¹ì…˜ (ìƒˆë¡œ ì¶”ê°€) -->
          <div class="settings-section">
              <div class="settings-header" data-i18n="advancedAudioSettings">ê³ ê¸‰ ì˜¤ë””ì˜¤ ì„¤ì •</div>
              <div class="settings-grid">
                  <div data-i18n="spatialReverb">ê³µê°„ ë°˜í–¥:</div>
                  <div>
                      <input type="checkbox" id="spatialReverb" checked>
                      <label for="spatialReverb" data-i18n="spatialReverbHint">ë²½ì—ì„œ ë°˜ì‚¬ë˜ëŠ” ì†Œë¦¬ íš¨ê³¼</label>
                  </div>
                  
                  <div data-i18n="reverbQuality">ë°˜í–¥ í’ˆì§ˆ:</div>
                  <div>
                      <select id="reverbQuality">
                          <option value="low" data-i18n="qualityLow">ë‚®ìŒ</option>
                          <option value="medium" selected data-i18n="qualityMedium">ì¤‘ê°„</option>
                          <option value="high" data-i18n="qualityHigh">ë†’ìŒ</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- ì„¤ì • ë³€ê²½ ì¦‰ì‹œ ì ìš© ì„¤ëª… -->
          <div class="settings-notice">
            <p data-i18n="settingsAutoSave">ëª¨ë“  ì„¤ì •ì€ ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤.</p>
          </div>
          
          <!-- í•˜ë‹¨ íŒ¨ë”© (ë²„íŠ¼ ê³µê°„ í™•ë³´) -->
          <div style="height: 100px;"></div>
      </div>
      
      <!-- ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ (í•˜ë‚˜ë§Œ í‘œì‹œ) -->
      <button id="returnToGameButton" class="return-button" data-i18n="returnToGame">ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>
  
  <div id="gameOverScreen" class="screen" style="display: none;">
      <h1 data-i18n="gameOver">ê²Œì„ ì¢…ë£Œ</h1>
      <p><span data-i18n="finalScore">ìµœì¢… ì ìˆ˜</span>: <span id="finalScore">0</span></p>
      <button id="restartButton" class="button" data-i18n="restartButton">ë‹¤ì‹œ ì‹œì‘</button>
  </div>
  
  <div id="gameUI">
      <div><span data-i18n="score">ì ìˆ˜</span>: <span id="score">0</span></div>
      <div><span data-i18n="ammo">íƒ„ì•½</span>: <span id="ammo">30</span> / <span id="maxAmmo">30</span></div>
      <div><span data-i18n="timeLeft">ë‚¨ì€ ì‹œê°„</span>: <span id="timer">60</span><span data-i18n="seconds">ì´ˆ</span></div>
  </div>
  
  <!-- ì„¤ì • ë²„íŠ¼ (ê²Œì„ UI ë°–ìœ¼ë¡œ ì´ë™) -->
  <button id="settingsButton" class="settings-btn">âš™ï¸ <span data-i18n="settings">ì„¤ì •</span></button>
  
  <!-- ì½¤ë³´ ì¹´ìš´í„° -->
  <div id="combo" class="combo-counter">3x Combo (1.5x)</div>
  
  <div class="health-bar">
      <div class="health-fill" id="healthFill"></div>
  </div>
  
  <img id="crosshair" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iOCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CiAgPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMSIgZmlsbD0id2hpdGUiLz4KICA8bGluZSB4MT0iMTAiIHkxPSIzIiB4Mj0iMTAiIHkyPSI3IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8bGluZSB4MT0iMTAiIHkxPSIxMyIgeDI9IjEwIiB5Mj0iMTciIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPgogIDxsaW5lIHgxPSIzIiB5MT0iMTAiIHgyPSI3IiB5Mj0iMTAiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPgogIDxsaW5lIHgxPSIxMyIgeTE9IjEwIiB4Mj0iMTciIHkyPSIxMCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==" alt="Crosshair">
  
  <div id="hitMarker">âœ•</div>
  <div id="gunEffects"></div>
  
  <div id="mobileControls">
      <div id="joystick">
          <div id="joystickKnob"></div>
      </div>
      <div id="shootButton" data-i18n="shoot">ë°œì‚¬</div>
  </div>
  
  <a target="_blank" href="https://jam.pieter.com" style="font-family: 'system-ui', sans-serif; position: fixed; bottom: -1px; right: -1px; padding: 7px; font-size: 14px; font-weight: bold; background: #fff; color: #000; text-decoration: none; z-index: 10000; border: 1px solid #fff; border-top-left-radius: 12px;">ğŸ•¹ï¸ Vibe Jam 2025</a>
  
  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ - async ì†ì„± ì¶”ê°€í•˜ì—¬ ë³‘ë ¬ ë¡œë“œ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
  
  <!-- ë¨¼ì € ë¡œì»¬ë¼ì´ì œì´ì…˜ ëª¨ë“ˆ ë¡œë“œ -->
  <script src="js/Localization.js"></script>
  
  <!-- ì¦‰ì‹œ ê²Œì„ ì‹œì‘ì„ ìœ„í•œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ëª¨ë°”ì¼ í™˜ê²½ ê°ì§€ ë° ì²˜ë¦¬
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if (isMobile) {
      document.body.classList.add('is-mobile');
      document.getElementById('mobileSettings').style.display = 'block';
    }
    
    // ê°€ë¡œ/ì„¸ë¡œ ëª¨ë“œ ê°ì§€ ë° ì²˜ë¦¬
    function checkOrientation() {
      if (window.innerWidth > window.innerHeight) {
        document.body.classList.add('landscape');
        document.body.classList.remove('portrait');
      } else {
        document.body.classList.add('portrait');
        document.body.classList.remove('landscape');
      }
    }
    
    // ì´ˆê¸° ë°©í–¥ ì„¤ì •
    checkOrientation();
    
    // ë°©í–¥ ë³€ê²½ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    window.addEventListener('resize', checkOrientation);
    window.addEventListener('orientationchange', checkOrientation);
  
    // ë¡œì»¬ë¼ì´ì œì´ì…˜ ì´ˆê¸°í™”
    if (typeof Localization !== 'undefined') {
      Localization.init();
    }
    
    // DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
      if (typeof Localization !== 'undefined') {
        Localization.updateAllTexts();
        
        // ì–¸ì–´ ì„ íƒê¸° ì´ˆê¸°í™”
        const languageSelect = document.getElementById('languageSelect');
        if (languageSelect) {
          languageSelect.value = Localization.currentLanguage;
          
          // ì–¸ì–´ ë³€ê²½ ì´ë²¤íŠ¸ ë“±ë¡ (ì¦‰ì‹œ ì ìš©)
          languageSelect.addEventListener('change', function() {
            Localization.setLanguage(this.value);
          });
        }
      }
      
      // ì„¤ì • ë²„íŠ¼ ìš”ì†Œ ì°¸ì¡°
      const settingsBtn = document.getElementById('settingsButton');
      const settingsScreen = document.getElementById('settingsScreen');
      
      // ESC í‚¤ë¡œ ì„¤ì • ì°½ ë‹«ê¸° ê¸°ëŠ¥ ì¶”ê°€
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          if (settingsScreen.style.display === 'flex') {
            closeSettings();
          }
        }
      });
      
      // ì„¤ì • ì°½ ë‹«ê¸° í•¨ìˆ˜
      function closeSettings() {
        settingsScreen.style.display = 'none';
        
        // ì„¤ì • ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
        if (settingsBtn) {
          settingsBtn.classList.remove('hidden');
        }
        
        // ì„¤ì • ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
        if (typeof GameSettings !== 'undefined') {
          GameSettings.saveSettings();
        }
        
        // ê²Œì„ì— ì„¤ì • ì°½ ë‹«í˜ ì•Œë¦¼
        if (typeof Game !== 'undefined' && Game.gameStarted) {
          Game.isSettingsOpen = false;
          
          // ëª¨ë°”ì¼ì´ ì•„ë‹ ê²½ìš°ì—ë§Œ í¬ì¸í„° ë½ ìš”ì²­
          if (!isMobile) {
            try {
              Graphics.renderer.domElement.requestPointerLock();
            } catch (e) {
              console.warn('Pointer lock request failed:', e);
            }
          }
        }
      }
      
      // ì„¤ì • ì°½ ì—´ê¸° í•¨ìˆ˜
      function openSettings() {
        // ì„¤ì • ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        if (settingsBtn) {
          settingsBtn.classList.add('hidden');
        }
        
        // ì„¤ì • í™”ë©´ í‘œì‹œ
        settingsScreen.style.display = 'flex';
        
        // ì„¤ì • ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
        if (typeof Game !== 'undefined') {
          Game.showSettings();
        }
      }
      
      // ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼
      const returnButton = document.getElementById('returnToGameButton');
      if (returnButton) {
        returnButton.addEventListener('touchstart', function(e) {
          e.preventDefault();
          e.stopPropagation();
          closeSettings();
        });
        
        returnButton.addEventListener('click', function() {
          closeSettings();
        });
      }
      
      // ì„¤ì • ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      if (settingsBtn) {
        // ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬
        settingsBtn.addEventListener('touchstart', function(e) {
          e.preventDefault();
          e.stopPropagation();
          openSettings();
        });
        
        // ì¼ë°˜ í´ë¦­ ì´ë²¤íŠ¸ë„ ìœ ì§€
        settingsBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          openSettings();
        });
      }
      
      // ì„¤ì • ë³€ê²½ ì¦‰ì‹œ ì ìš©
      document.querySelectorAll('#settingsScreen select, #settingsScreen input').forEach(element => {
        element.addEventListener('change', function() {
          if (typeof GameSettings !== 'undefined') {
            GameSettings.saveSettings();
          }
        });
      });
    });
    
    // ì¡°ì‘ë²• íŒ ì œì–´
    setTimeout(() => {
      const tip = document.getElementById('overlayTip');
      if (tip) {
        tip.style.opacity = '0';
        setTimeout(() => {
          tip.remove();
        }, 500);
      }
    }, 3000);

    // ê²Œì„ UI ì„œì„œíˆ ë‚˜íƒ€ë‚˜ê²Œ
    setTimeout(() => {
      document.getElementById('gameUI').classList.add('visible');
    }, 1000);
    
    // ëª¨ë“  ê²Œì„ ëª¨ë“ˆì´ ë¡œë“œë˜ë©´ ìë™ìœ¼ë¡œ ê²Œì„ ì‹œì‘
    function initializeAndStartGame() {
      // ê²Œì„ ëª¨ë“ˆ ë¡œë“œ
      const modules = [
        'js/EventSystem.js',
        'js/GameSettings.js',
        'js/AudioManager.js',
        'js/BGMManager.js',        // ë°°ê²½ ìŒì•… ê´€ë¦¬ (ì¶”ê°€ë¨)
        'js/SpatialAudioSystem.js',
        'js/InputManager.js',
        'js/Graphics.js',
        'js/Physics.js',
        'js/Environment.js',
        'js/ParticleSystem.js',
        'js/TargetManager.js',
        'js/GitHubTarget.js',
        'js/PortalSystem.js',
        'js/Game.js'
      ];
      
      let loadedCount = 0;
      
      // ê° ëª¨ë“ˆ ë¡œë“œ
      modules.forEach(src => {
        const script = document.createElement('script');
        script.src = src;
        script.async = false; // ê²Œì„ ëª¨ë“ˆì€ ìˆœì„œëŒ€ë¡œ ë¡œë“œë˜ì–´ì•¼ í•¨
        
        script.onload = () => {
          loadedCount++;
          if (loadedCount === modules.length) {
            console.log('ëª¨ë“  ê²Œì„ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
            // ëª¨ë“  ëª¨ë“ˆì´ ë¡œë“œë˜ê³  1ì´ˆ í›„ ê²Œì„ ìë™ ì‹œì‘
            setTimeout(() => {
              if (typeof Game !== 'undefined' && Game.startGame) {
                // startGame í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ ê²Œì„ ì‹œì‘
                document.getElementById('startScreen').style.display = 'none';
                Game.startGame();
              }
            }, 1000);
          }
        };
        
        document.body.appendChild(script);
      });
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì¦‰ì‹œ ê²Œì„ ì´ˆê¸°í™” ë° ì‹œì‘
    initializeAndStartGame();
  </script>
</body>
</html>
